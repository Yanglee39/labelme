import json
import glob
import random
import PIL.Image
import numpy as np
from labelme import utils

def main():
    # 读取目录
    labelme_json = glob.glob(
        r'/mnt/lijun/fcg_data_word/joint_word_json/*.json')
    json_size = len(labelme_json)

    # 划分训练集和验证集
    random.seed(10)
    train_dataset = random.sample(labelme_json, int(float(json_size * 0.6)))
    labelme_json_remain = list(set(labelme_json) - set(train_dataset))  # 取补集
    val_dataset = random.sample(labelme_json_remain,
                                int(float(json_size * 0.2)))
    test_dataset = list(set(labelme_json_remain) - set(val_dataset))
    print(f'训练集数量：{len(train_dataset)}')
    print(f'验证集数量：{len(val_dataset)}')
    print(f'测试集数量：{len(test_dataset)}')

    # 格式转换
    labelme2coco(val_dataset, './coco/annotations/instances_val2017.json')
    labelme2coco(test_dataset, './coco/annotations/instances_test2017.json')
    labelme2coco(train_dataset, './coco/annotations/instances_train2017.json')
